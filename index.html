<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>ESP8266 Smart System</title>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC1a-XkNqLQ-fR9K9G3rRq4H3k9SKw9EF0",
  databaseURL: "https://kjszz-1a818-default-rtdb.firebaseio.com/",
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== ELEMENT =====
const btn = document.getElementById("toggle");
const statusEl = document.getElementById("status");
const soilEl = document.getElementById("soil");
const tempEl = document.getElementById("temp");
const alarmEl = document.getElementById("alarm");

// ===== CONTROL =====
btn.onclick = () => {
  const enable = btn.dataset.state !== "on";
  set(ref(db, "control/enable"), enable);
};

// ===== REALTIME LISTEN =====
onValue(ref(db, "control/enable"), snap => {
  const on = snap.val();
  btn.dataset.state = on ? "on" : "off";
  btn.textContent = on ? "üü¢ SYSTEM ON" : "üî¥ SYSTEM OFF";
  statusEl.textContent = on ? "‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô" : "‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô";
});

onValue(ref(db, "sensor"), snap => {
  const d = snap.val() || {};
  soilEl.textContent = d.soil ?? "--";
  tempEl.textContent = d.temperature ?? "--";
  alarmEl.textContent = d.alarm ? "‚ö†Ô∏è ALERT" : "‡∏õ‡∏Å‡∏ï‡∏¥";
  alarmEl.className = d.alarm ? "alarm on" : "alarm";
});
</script>

<style>
body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(135deg,#1e3c72,#2a5298);
  color: #fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.card {
  background:#ffffff20;
  backdrop-filter: blur(10px);
  padding:30px;
  border-radius:20px;
  width:320px;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
  text-align:center;
}

h1 {
  margin-top:0;
  font-size:22px;
}

button {
  width:100%;
  padding:15px;
  font-size:18px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  margin-bottom:20px;
  transition:.2s;
}

button[data-state="on"] {
  background:#2ecc71;
  color:#000;
}

button[data-state="off"] {
  background:#e74c3c;
  color:#fff;
}

.data {
  background:#00000030;
  border-radius:12px;
  padding:12px;
  margin:8px 0;
  font-size:16px;
}

.alarm.on {
  color:#ff4444;
  font-weight:bold;
}
</style>
</head>

<body>
  <div class="card">
    <h1>ESP8266 Smart Control</h1>

    <button id="toggle" data-state="off">üî¥ SYSTEM OFF</button>
    <div id="status">‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</div>

    <div class="data">üå± Soil : <span id="soil">--</span> %</div>
    <div class="data">üå° Temp : <span id="temp">--</span> ¬∞C</div>
    <div class="data alarm" id="alarm">‡∏õ‡∏Å‡∏ï‡∏¥</div>
  </div>
</body>
</html>
